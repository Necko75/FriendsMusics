
var DB = require('models/mysqlConnection');

var Notifications = {

	getSharedSongNotifications : function(session, callback) {

		var query = 'SELECT COUNT(id) as total_notifs FROM shared_songs WHERE seen = 0 AND id_user_receiver = "'+session.user_id+'"';
		DB.query(query, function(err, rows, fields) {
			if (!err)
			{
				console.log(rows);
				callback(rows);
			}
		});
	},

	getSharedSongNotificationsToDisplay : function(session, callback) {

		var query = 'SELECT shared_songs.id as id, shared_songs.id_user_sender as id_sender, musics.name as musicName, musics.author as author, url, (SELECT pseudo FROM users WHERE users.id = shared_songs.id_user_sender) as pseudo FROM shared_songs, musics WHERE musics.id = shared_songs.id_song AND shared_songs.id_user_receiver = "'+session.user_id+'" AND shared_songs.seen = 0';
		DB.query(query, function(err, rows, fields) {
			if (!err)
			{
				console.log(rows);
				callback(rows);
			}
		});
	},

	removeSharedSongNotification : function(session, notif, callback) {

		var query = 'DELETE FROM shared_songs WHERE id = "'+notif.id+'"';
		DB.query(query, function(err, rows, fields) {
			if (!err)
			{
				callback();
			}
		});
	}
};

module.exports = Notifications;